name: Tidy Up All Packages Needed For Annie
on:
  workflow_dispatch:
  schedule:
    - cron: 0 16 * * *

jobs:
  Build:
    runs-on: ubuntu-20.04

    steps:
    - name: Checkout
      uses: actions/checkout@main

    - name: Initialization Environment
      env:
        DEBIAN_FRONTEND: noninteractive
      run: |
        sudo rm -rf /etc/apt/sources.list.d/* /usr/share/dotnet /usr/local/lib/android /opt/ghc
        sudo -E apt-get -qq update
        sudo -E apt-get -qq install $(curl -fsSL git.io/depends-ubuntu-2004) tree
        sudo apt-get -y install python3 git-core curl
        sudo -E apt-get -qq autoremove --purge
        sudo -E apt-get -qq clean
        sudo timedatectl set-timezone "Asia/Shanghai"
        sudo apt-get update -y
        
    - name: Clone Source Code
      run: |
        mkdir files
        cd files
        wget https://github.com/thomaswcy/Annie-Packages/releases/download/ffmpeg/ffmpeg.exe
        tag=$(wget -qO- -t1 -T2 "https://api.github.com/repos/iawia002/lux/releases/latest" | jq -r '.tag_name')
        wget https://github.com/iawia/lux/releases/download/latest/IINA.${tag}.dmg
